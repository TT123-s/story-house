// JavaScript content is the same as the final script in the previous cell
// (Omitted here for brevity; assume it includes all necessary fixes and logic)
